define("modules/clean/metrics/coin",["require","exports","tslib","apex-metrics","dropbox/proto/apex_metrics_web/apex_metrics_web","google/protobuf/timestamp","google/protobuf/empty"],(function(e,t,n,i,o,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newCoinState=function(){return o.apex_metrics_web.ApexMetricsCacheData.CoinState.create({lastFlipTime:null,lastResult:!1,numTimesChecked:0})},t.protobufCoinToAPIv2Coin=function(e){var t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit){case"independent":t={".tag":"independent"};break;case"permanent":t={".tag":"permanent"};break;case"nResults":t={".tag":"n_results",n_results:e.stickiness.nResults};break;case"nSeconds":t={".tag":"n_seconds",n_seconds:e.stickiness.nSeconds}}return{fraction:null!==e.fraction?e.fraction:void 0,stickiness:t?{limit:t}:void 0}},t.APIv2CoinToProtobufCoin=function(e){var t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit[".tag"]){case"independent":t={independent:a.google.protobuf.Empty.create()};break;case"permanent":t={permanent:a.google.protobuf.Empty.create()};break;case"n_results":t={nResults:e.stickiness.limit.n_results};break;case"n_seconds":t={nSeconds:e.stickiness.limit.n_seconds}}return o.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.create({fraction:e.fraction,stickiness:t?o.apex_metrics_web.RecordNamespace.StickinessV2.create(t):void 0})},t.observeCoin=function(e,t,o){if(!t.stickiness||!t.stickiness.limit)return{nextState:o,result:!1};var a,s,c=Date.now()/1e3,p=o.lastFlipTime,u=void 0===p?r.google.protobuf.Timestamp.create({seconds:0,nanos:0}):p,l=o.lastResult,d=o.numTimesChecked,m=void 0===d?0:d,_=!1;switch(t.stickiness.limit[".tag"]){case"n_results":_=null===m||m%t.stickiness.limit.n_results==0;break;case"n_seconds":if(!u){_=!0;break}_=i.Instant.toMilliseconds({value:(a=c,s=u.seconds,"number"!=typeof a?a.sub(s).toNumber():"number"==typeof s?a-s:s.sub(a).negate().toNumber()),unit:i.TimeUnit.SECONDS})>i.Instant.toMilliseconds({value:t.stickiness.limit.n_seconds,unit:i.TimeUnit.SECONDS});break;case"permanent":_=0===m;break;case"independent":_=!0;break;case"other":default:return{nextState:o,result:!1}}if(_){var f=e()<(t.fraction||0);return{nextState:{lastFlipTime:r.google.protobuf.Timestamp.create({seconds:c,nanos:0}),lastResult:f,numTimesChecked:m?m+1:1},result:f}}return{nextState:n.__assign(n.__assign({},o),{numTimesChecked:m?m+1:1}),result:!!l}}})),define("modules/clean/metrics/filter",["require","exports","tslib","modules/clean/metrics/coin","modules/clean/metrics/serialization"],(function(e,t,n,i,o){"use strict";function r(e,t){return n.__awaiter(this,void 0,Promise,(function(){var i,o,r,a,s,c,p;return n.__generator(this,(function(n){switch(n.label){case 0:if(i=null,"undefined"==typeof msCrypto)return[3,2];for(o=new Uint8Array(t.length),a=0;a<t.length;a++)o[a]=t.charCodeAt(a);return r=msCrypto.subtle.digest("SHA-256",o.buffer),[4,new Promise((function(e,t){r.oncomplete=function(){return e(r.result)}}))];case 1:for(c=n.sent(),p=new Uint32Array(c),i=p[0],a=1;a<p.length;a++)i^=p[a];return[3,4];case 2:return"undefined"!=typeof crypto&&crypto.subtle&&"undefined"!=typeof TextEncoder?(s=new TextEncoder,[4,crypto.subtle.digest("SHA-256",s.encode(t))]):[3,4];case 3:c=n.sent(),p=new Uint32Array(c),i=p.reduce((function(e,t){return e^t})),n.label=4;case 4:return null===i?[2,0]:[2,((i^e)>>>0)/4294967296]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.makeNamespaceMap=function(e,t){for(var n={},o=0,r=e;o<r.length;o++){var a=r[o],s=a.metric_namespace;n[s]={dropFractionOfHostsPerMetric:a.drop_fraction_of_hosts_per_metric||null,dropPeriodCoin:a.drop_periods?{config:a.drop_periods,state:t.namespaceCoinState&&t.namespaceCoinState[s]&&t.namespaceCoinState[s].dropPeriodCoin||i.newCoinState()}:null,dropSamplesCoin:a.drop_samples?{config:a.drop_samples,state:t.namespaceCoinState&&t.namespaceCoinState[s]&&t.namespaceCoinState[s].dropSamplesCoin||i.newCoinState()}:null}}return n};var a=(function(){function e(e,t,n,i,o,r){this.filterID=e,this.randomEngine=t,this.clock=n,this.maxScopes=i,this.namespaceMap=o,this.configuredNamespaces=r}return e.prototype.extend=function(t,i,o){return new e(this.filterID,this.randomEngine,this.clock,t||this.maxScopes,n.__assign(n.__assign({},this.namespaceMap),i),o)},e.prototype.getState=function(){var e={filterID:this.filterID,namespaceCoinState:{}};for(var t in this.namespaceMap)this.namespaceMap.hasOwnProperty(t)&&(e.namespaceCoinState[t]={dropPeriodCoin:this.namespaceMap[t].dropPeriodCoin?n.__assign({},this.namespaceMap[t].dropPeriodCoin.state):null,dropSamplesCoin:this.namespaceMap[t].dropSamplesCoin?n.__assign({},this.namespaceMap[t].dropSamplesCoin.state):null});return e},e.prototype.getConfiguredNamespaces=function(){return this.configuredNamespaces},e.prototype.partitionAndSerializeSpans=function(e,t,a){return n.__awaiter(this,void 0,Promise,(function(){var s,c,p,u,l=this;return n.__generator(this,(function(d){switch(d.label){case 0:return s=[],c=new Map,p=0,u=[],e.forEach((function(e,d){u.push(n.__awaiter(l,void 0,void 0,(function(){var u,l,m,_,f,h,g,v,w,b,S,y=this;return n.__generator(this,(function(n){switch(n.label){case 0:if(u=this.namespaceMap[d]||{},l=u.dropPeriodCoin,m=u.dropSamplesCoin,_=u.dropFractionOfHostsPerMetric,!this.configuredNamespaces.has(d))return c.set(d,e),[2];if(l&&(f=i.observeCoin(this.randomEngine,l.config,l.state),h=f.result,g=f.nextState,l.state=g,h))return[2];if(m&&(e=e.map((function(e){return{namespace:e.namespace,metricName:e.metricName,tags:e.tags,samples:e.samples.filter((function(){var e=i.observeCoin(y.randomEngine,m.config,m.state),t=e.result,n=e.nextState;return m.state=n,!t}))}})).filter((function(e){return Object.keys(e.samples).length>0}))),!_)return[3,5];v=[],w=0,b=e,n.label=1;case 1:return w<b.length?(S=b[w],[4,r(this.filterID,S.metricName)]):[3,4];case 2:n.sent()>=_&&v.push(S),n.label=3;case 3:return w++,[3,1];case 4:e=v,n.label=5;case 5:return 0===e.length?[2]:(0===this.maxScopes||p<this.maxScopes?(s.push(o.formatSpansAsScope(a,d,e,t)),p++):c.set(d,e),[2])}}))})))})),[4,Promise.all(u)];case 1:return d.sent(),[2,[s,c]]}}))}))},e})();t.SpanGroupFilter=a})),define("modules/clean/metrics/index",["require","exports","apex-metrics","modules/clean/api_v2/noauth_client","modules/clean/metrics/sink"],(function(e,t,n,i,o){"use strict";function r(){return new n.BrowserPerformanceClock}Object.defineProperty(t,"__esModule",{value:!0});var a=new i.NoAuthApiV2Client,s=new o.Apiv2MetricsSink(a,r(),o.makeDefaultInitialization(a),o.makeDefaultCacheFactory(),new n.SetTimeoutExecutor((function(){return{value:5*Math.random(),unit:n.TimeUnit.SECONDS}})),Math.random);t.getMetricsReporter=function(){return n.MetricsReporterImpl.root(s,r())}})),define("modules/clean/metrics/serialization",["require","exports"],(function(e,t){"use strict";function n(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t.push({name:{value:{".tag":"string_value",string_value:n}},value:{value:{".tag":"string_value",string_value:i}}})}return t}function i(e){return{name:{value:{".tag":"string_value",string_value:e.metricName}},data:{".tag":"numerical_data",samples:e.samples}}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatTags=n,t.formatSamples=i,t.formatSpansAsScope=function(e,t,o,r){var a=new Map;return o.forEach((function(e){var t,n=JSON.stringify(e.tags);a.has(n)||a.set(n,{});var i=a.get(n);i.hasOwnProperty(e.metricName)?(t=i[e.metricName].samples).push.apply(t,e.samples):i[e.metricName]=e})),{timestamp_sec:e,metric_namespace:t,tags:n(r),descendants:Array.from(a.values()).map((function(e){return{tags:n(e[Object.keys(e)[0]].tags),metrics:Object.keys(e).map((function(t){return i(e[t])}))}}))}}})),define("modules/clean/metrics/sink",["require","exports","tslib","apex-metrics","eventemitter3","modules/clean/metrics/coin","modules/clean/metrics/filter","modules/core/browser_detection","modules/constants/page_load","modules/core/exception","google/protobuf/timestamp","dropbox/proto/apex_metrics_web/apex_metrics_web","proto_utils/unpack"],(function(e,t,n,i,o,r,a,s,c,p,u,l,d){"use strict";var m;Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),s=n.__importStar(s),p=n.__importStar(p),(function(e){e.ALLOWED="allowed",e.DENIED="denied"})(m=t.PublishType||(t.PublishType={}));var _={".tag":"trigger_heartbeat"},f={".tag":"trigger_publish"},h={client_version:6,implementation:{".tag":"typescript"}};function g(e,t,n){var i,o=[];return t.forEach((function(e){return o.push(e)})),{scopes:e,known_namespaces:o,environment:"prod",artifact_name:"dropbox-web",artifact_version:c.REPO_REV,client_metadata:h,trigger:n,os:s.mac?{name:{".tag":"mac"},version:"unknown"}:s.windows?{name:{".tag":"windows"},version:(i=s.windowsInfo,i.windowsXP||i.windowsXPx64?"XP":i.windowsVista?"Vista":i.windows7?"7":i.windows8?"8":i.windows8_1?"8.1":i.windows10?"10 Unknown":"unknown")}:s.is_android()?{name:{".tag":"android"},version:"unknown"}:s.iOS?{name:{".tag":"ios"},version:"unknown"}:{name:{".tag":"unknown_os"},version:"unknown"}}}t.makeDefaultInitialization=function(e){var i=this;return function(o){return n.__awaiter(i,void 0,void 0,(function(){var i,a,s,c,u,m;return n.__generator(this,(function(n){switch(n.label){case 0:return i=[],!o||!(a=(function(e){var n=e.getItem(t._PERSISTENTCACHE_KEY);if(null===n)return null;var i,o=Date.now()/1e3,a=[];try{i=d.unpackProto(n,l.apex_metrics_web.ApexMetricsCacheData)}catch(e){return p.reportException({err:e,tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],severity:"non-critical"}),null}if(!i.config||!i.state||!i.timeStored)return p.reportStack("Sink cache was missing data",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;var s=(function(e,t){if("number"!=typeof e)return e.sub(t).toNumber();if("number"==typeof t)return e-t;return t.sub(e).negate().toNumber()})(o,i.timeStored.seconds);if(s<0)return p.reportStack("Sink cache was stored in the future instead of the past",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;var c={};i.config&&(a=i.config.reportingConfigs.map((function(e){return e.metricNamespace})),c.reporting_configs=i.config.reportingConfigs?i.config.reportingConfigs.filter((function(e){return s<e.maxTimeUntilRefreshSeconds})).map((function(e){return{metric_namespace:e.metricNamespace,max_time_until_refresh_seconds:e.maxTimeUntilRefreshSeconds,stop_publication_for_seconds:e.stopPublicationForSeconds,drop_samples:e.dropSamples?r.protobufCoinToAPIv2Coin(e.dropSamples):void 0,drop_periods:e.dropPeriods?r.protobufCoinToAPIv2Coin(e.dropPeriods):void 0,drop_fraction_of_hosts_per_metric:e.dropFractionOfHostsPerMetric,aggregation_interval_seconds:e.aggregationIntervalSeconds}})):[],c.publication_interval_seconds=i.config.publicationIntervalSeconds,c.max_scopes_per_request=i.config.maxScopesPerRequest,c.stop_publication_for_seconds=i.config.stopPublicationForSeconds,c.debug_infos=i.config.debugInfos);return{config:c,state:i.state,knownNamespaces:a}})(o))||(i=a.knownNamespaces,s=new Set,a.config.reporting_configs.forEach((function(e){return s.add(e.metric_namespace)})),i.some((function(e){return!s.has(e)})))?(c=new Set,i.forEach((function(e){return c.add(e)})),[4,e.ns("client_metrics").rpc("record",g([],c,_),{})]):[2,a];case 1:return u=n.sent(),m=Math.floor(4294967296*Math.random())>>>0,[2,{knownNamespaces:i,config:u,state:{filterID:m,namespaceCoinState:{}}}]}}))}))}},t._PERSISTENTCACHE_KEY="amp-sink-cache",t.makeDefaultCacheFactory=function(){return function(){try{return window.localStorage||null}catch(e){return null}}};var v=(function(){function e(e,t,n,i,r,a){var s=this;this.client=e,this.clock=t,this.initializer=n,this.cacheFactory=i,this.executor=r,this.randomEngine=a,this.nextRequest=null,this.queuedSpans=new Map,this.knownNamespaces=new Set,this.eventEmitter=new o.default,this.cache=this.cacheFactory(),this.currentRequest=this.initializer(this.cache).then((function(e){return e&&s.updateConfiguration(e.config,e.state),s.eventEmitter.emit("initialized"),e.config||null}))}return e.prototype.updateConfiguration=function(e,n){var o=this,a=e.reporting_configs,s=void 0===a?[]:a,c=e.stop_publication_for_seconds,p=e.publication_interval_seconds;s.forEach((function(e){o.knownNamespaces.add(e.metric_namespace)})),this.updateBlackoutCallback({value:c,unit:i.TimeUnit.SECONDS}),this.updatePublishTimer({value:p,unit:i.TimeUnit.SECONDS}),this.updateSpanGroupFilter(e,n,this.knownNamespaces),this.cache&&(function(e,n,i){try{var o=Math.floor(Date.now()/1e3),a=l.apex_metrics_web.ApexMetricsCacheData.create({config:l.apex_metrics_web.RecordNamespace.RecordResponse.create({reportingConfigs:n.reporting_configs?n.reporting_configs.map((function(e){return l.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.create({metricNamespace:e.metric_namespace,maxTimeUntilRefreshSeconds:e.max_time_until_refresh_seconds,stopPublicationForSeconds:e.stop_publication_for_seconds,dropSamples:e.drop_samples?r.APIv2CoinToProtobufCoin(e.drop_samples):void 0,dropPeriods:e.drop_periods?r.APIv2CoinToProtobufCoin(e.drop_periods):void 0,dropFractionOfHostsPerMetric:e.drop_fraction_of_hosts_per_metric,aggregationIntervalSeconds:e.aggregation_interval_seconds})})):[],publicationIntervalSeconds:n.publication_interval_seconds,maxScopesPerRequest:n.max_scopes_per_request,stopPublicationForSeconds:n.stop_publication_for_seconds,debugInfos:n.debug_infos||[]}),timeStored:u.google.protobuf.Timestamp.create({seconds:o,nanos:0}),state:i});e.setItem(t._PERSISTENTCACHE_KEY,d.packProto(a))}catch(e){}})(this.cache,e,n)},e.prototype.updateSpanGroupFilter=function(e,t,n){for(var i=e.reporting_configs,o=void 0===i?[]:i,r=e.max_scopes_per_request,s=new Set,c=n.values(),p=c.next();!p.done;p=c.next())s.add(p.value);var u=a.makeNamespaceMap(o,t);this.spanGroupFilter=this.spanGroupFilter?this.spanGroupFilter.extend(r,u,s):new a.SpanGroupFilter(t.filterID,this.randomEngine,this.clock,r,u,s)},e.prototype.updateBlackoutCallback=function(e){var t=this;0!==e.value?(this.blackoutCallback=function(){return t.blackoutCallback=null,t.eventEmitter.emit("publicationResumed"),!1},this.eventEmitter.emit("publicationPaused"),this.executor.executeEvery(e,this.blackoutCallback)):this.blackoutCallback=null},e.prototype.updatePublishTimer=function(e){var t=this;if(0!==e.value){if(!this.publishTimer||i.Instant.toMilliseconds(this.publishTimer.period)!==i.Instant.toMilliseconds(e)){var n={period:e,callback:function(){return t.publishTimer===n&&(t.nextRequest=t.currentRequest.then((function(){t.nextRequest=null,t.currentRequest=t.send()})),!0)}};this.publishTimer=n,this.executor.executeEvery(this.publishTimer.period,this.publishTimer.callback)}}else this.publishTimer=null},e.prototype.send=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i,o,r,a,c,p,u,l,d,_,h,v,w;return n.__generator(this,(function(n){switch(n.label){case 0:if(this.blackoutCallback)return this.eventEmitter.emit("publish",m.DENIED),[2,null];for(e=Math.floor(Date.now()/1e3),t=[[s.chrome,"chrome"],[s.edge,"edge"],[s.mozilla,"firefox"],[s.msie,"msie"],[s.safari,"safari"]],i="other",o=0,r=t;o<r.length;o++)if((a=r[o])[0]){i=a[1];break}return c={browser:i},[4,this.spanGroupFilter.partitionAndSerializeSpans(this.queuedSpans,c,e)];case 1:if(p=n.sent(),u=p[0],l=p[1],d=null,this.queuedSpans=l,!(_=u.length>0))for(h=this.spanGroupFilter.getConfiguredNamespaces(),v=this.knownNamespaces.values(),w=v.next();!w.done;w=v.next())if(!h.has(w.value)){_=!0;break}return _?[4,this.client.ns("client_metrics").rpc("record",g(u,this.knownNamespaces,f),{})]:[3,3];case 2:d=n.sent(),this.updateConfiguration(d,this.spanGroupFilter.getState()),n.label=3;case 3:return this.eventEmitter.emit("publish",m.ALLOWED),[2,d]}}))}))},e.prototype.recordSpan=function(e){var t=this;this.knownNamespaces.add(e.namespace),this.queuedSpans.has(e.namespace)||this.queuedSpans.set(e.namespace,[]),this.queuedSpans.get(e.namespace).push(e),this.nextRequest||(this.nextRequest=this.currentRequest.then((function(){t.publishTimer||(t.currentRequest=t.send()),t.nextRequest=null})))},e})();t.Apiv2MetricsSink=v})),define("modules/clean/perf_tools/resource_utils",["require","exports","tslib","modules/core/browser","modules/clean/js_client_stopwatch","modules/clean/perf_tools/cpu_utils"],(function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),r=n.__importStar(r),t.logResourcesData=function(e){(function(e){var t=window.requireContexts;if(!t)return;var n=r.listExecutionPerfMeasurementsForRequireContexts(t),i=o.JSStopwatch.createDetachedStopwatch("resource_init_timeline",e);n.forEach((function(e){var t=i.startSpan(e.name,{startTime:e.startTime});i.addSpanAnnotation(e.name,"totalTimeNs",Math.round(1e6*e.totalTime).toString(),t),i.endSpan(e.name,{endTime:e.startTime+e.totalTime,spanId:t})})),i.logData()})(e),(function(e){var t=i.performance();if(!t||!t.getEntriesByType)return;var n=o.JSStopwatch.createDetachedStopwatch("resource_timeline",e),r={},a=t.getEntriesByType("resource");if(a instanceof Array)for(var p=0,u=a;p<u.length;p++){var l=u[p],d=s(l);if(d){var m=r[d]||0;r[d]=m+1,m>0&&(d=d+"-"+m);var _=n.startSpan(d,{startTime:l.startTime,async:!0}),f=c(l);n.addSpanAnnotation(d,"type",f,_),0===l.transferSize?n.addSpanAnnotation(d,"cached","true",_):void 0===l.transferSize?n.addSpanAnnotation(d,"cached","unknown",_):n.addSpanAnnotation(d,"cached","false",_),l.responseEnd<l.startTime?(n.addSpanAnnotation(d,"negativeSpanLength",(l.responseEnd-l.startTime).toString(),_),n.endSpan(d,{endTime:l.startTime,spanId:_})):n.endSpan(d,{endTime:l.responseEnd,spanId:_})}}n.logData()})(e)};var a=document&&document.createElement?document.createElement("a"):null;function s(e){if(a){if(a.href=e.name,a.host.match(/dropboxstatic.com$/)&&a.pathname.match(/^\/static/)){var t=a.pathname,n=t.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);n&&n.index&&(t=t.substring(0,n.index-1));for(var i=0,o=["/static/js/","/static/"];i<o.length;i++){var r=o[i];t.startsWith(r)&&(t=t.substring(r.length))}return t}return a.host.match(/photos-[0-9]+.dropbox.com$/)&&a.pathname.match(/^\/t\/2/)?"/thumbnail":void 0}}function c(e){var t=e.name,n=e.initiatorType,i=t.lastIndexOf(".");if(i>0){var o=t.substring(i);if([".png",".gif",".jpg",".svg"].indexOf(o)>-1)return"img";if(".js"===o)return"script";if(".css"===o)return"css"}return-1===["css","img","script","link"].indexOf(n)?"xmlhttprequest"===n?"ajax":"other":n}t.logResourceTiming=function(e){var t=i.performance();if(t&&t.getEntriesByType){var n=t.getEntriesByType("resource").filter((function(t){return-1!==t.name.indexOf(e)}))[0];if(n&&n.responseEnd){var r="resource_response_end_"+e;return o.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),o.JSStopwatch.recordTrace(r,{stopwatchName:"resource_timing",traceTime:n.responseEnd}),n}}},t.summarizePerformanceResourceTimings=function(e,t){void 0===t&&(t=void 0);var n={pre:{},total:{}};if(o.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),e instanceof Array)for(var i=function(e){var i=c(e),o=[];t&&e.responseEnd<=t&&(i in n.pre||(n.pre[i]={count:0,total_time:0,last_transfer_end:0}),o.push(n.pre[i])),i in n.total||(n.total[i]={count:0,total_time:0,last_transfer_end:0}),o.push(n.total[i]),o.forEach((function(t){var n;t.count++,t.total_time+=e.duration,t.last_transfer_end=Math.max(t.last_transfer_end,e.responseEnd),"css"!==(n=i)&&"script"!==n&&"img"!==n||void 0===e.transferSize||void 0===e.encodedBodySize||(t.total_size=t.total_size||0,t.transfer_size=t.transfer_size||0,0!==e.transferSize&&(t.transfer_size+=e.encodedBodySize),t.total_size=t.total_size||0,t.total_size+=e.encodedBodySize)}))},r=0,a=e;r<a.length;r++){i(a[r])}return n}})),define("modules/clean/perf_tools/cpu_utils",["require","exports","modules/clean/js_client_stopwatch"],(function(e,t,n){"use strict";var i;function o(e){if(e.require&&e.require.perfMeasurements){var t=0;return e.require.perfMeasurements.map((function(e){var n=e.name,i=e.startTime,o=e.totalTime;return n.endsWith("anon")&&(n+="-"+t++),{jsExecutionType:c(n),name:n,startTime:i,totalTime:o}}))}var n=e.module_callback_times;return Object.keys(n).filter((function(e){return n[e].callbackDuration&&n[e].callbackTime})).map((function(e){return{jsExecutionType:c(e),name:e,startTime:n[e].callbackTime,totalTime:n[e].callbackDuration}}))}function r(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t=t.concat(o(i))}return t}function a(e){return Object.keys(e).map((function(t){var n=e[t];return{measurement:{jsExecutionType:s(t),name:t,startTime:n.start,totalTime:n.end-n.start},annotations:n.annotations}}))}function s(e){return e.startsWith("dws-processChunk")?i.DWS:i.UNKNOWN}function c(e){return e.startsWith("execCb.anon")||e.startsWith("overhead.anon")||e.startsWith("execCb.require-tier")||e.startsWith("overhead.require-tier")?i.OTHER:e.startsWith("execCb")||e.startsWith("overhead")?i.MODULE:i.UNKNOWN}Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.DWS="dws",e.MODULE="module",e.OTHER="other",e.UNKNOWN="unknown"})(i=t.JSExecutionType||(t.JSExecutionType={})),t.ALL_JS_EXECUTION_TYPES=[i.DWS,i.MODULE,i.OTHER,i.UNKNOWN],t.getAllGlobalExecutionPerfMeasurements=function(){var e=[];return window.ensemble&&window.ensemble.getJSStopwatchData&&(e=e.concat(a(window.ensemble.getJSStopwatchData()).map((function(e){return e.measurement})))),window.requireContexts&&(e=e.concat(r(window.requireContexts))),e},t.listExecutionPerfMeasurementsForRequireContexts=r,t.listAnnotatedExecutionPerfMeasurementsForEnsemble=a,t.cumulativeExecutionTimesBefore=function(e,t){var n={},i=function(i){if(e.hasOwnProperty(i)){var o=e[i];n[i]={},t.forEach((function(e){0<e.startTime&&e.startTime<o&&(n[i][e.jsExecutionType]=n[i][e.jsExecutionType]||0,n[i][e.jsExecutionType]+=e.totalTime)}))}};for(var o in e)i(o);return n},t.logCumulativeExecutionTimes=function(e,i){var o=n.JSStopwatch.createDetachedStopwatch("cumulative_cpu_time",e),r=function(e){i.hasOwnProperty(e)&&t.ALL_JS_EXECUTION_TYPES.forEach((function(t){o.recordTrace("cpu_before_"+e+"_due_to_"+t,i[e][t]||0)}))};for(var a in i)r(a);o.logData()}})),define("modules/clean/perf_tools/browser_perf_utils",["require","exports","tslib","modules/core/browser","modules/core/xhr","modules/constants/request","modules/clean/js_client_stopwatch","modules/constants/webtiming"],(function(e,t,n,i,o,r,a,s){"use strict";function c(e){var t=i.performance();if(t&&t.timing){var n=t.timing,c={navigation_start:n.navigationStart,unload_event_start:n.unloadEventStart,unload_event_end:n.unloadEventEnd,redirect_start:n.redirectStart,redirect_end:n.redirectEnd,fetch_start:n.fetchStart,domain_lookup_start:n.domainLookupStart,domain_lookup_end:n.domainLookupEnd,connect_start:n.connectStart,secure_connect_start:n.secureConnectionStart,connect_end:n.connectEnd,request_start:n.requestStart,response_start:n.responseStart,response_end:n.responseEnd,dom_loading:n.domLoading,dom_interactive:n.domInteractive,dom_content_loaded_event_start:n.domContentLoadedEventStart,dom_content_loded_event_end:n.domContentLoadedEventEnd,dom_complete:n.domComplete,load_event_start:n.loadEventStart,load_event_end:n.loadEventEnd},p={};p.request_id=r.REQUEST_ID,p.referrer=document.referrer;var u=a.JSStopwatch.createDetachedStopwatch("browser_perf",e);for(var l in c)c.hasOwnProperty(l)&&(p[l]=c[l],c[l]&&u.recordTrace(l,c[l]-n.navigationStart));u.logData(),s.LOG_BROWSER_PERFORMANCE_INFO&&o.sendXhr("/alternate_wtl_browser_performance_info",p)}}Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i),o=n.__importStar(o),r=n.__importStar(r),s=n.__importStar(s),t.logBrowserPerfData=function(e){(function(e){var t=i.performance();if(!t||!t.getEntriesByType)return;var n=a.JSStopwatch.createDetachedStopwatch("performance_marks",e),o=t.getEntriesByType("mark");if(o instanceof Array)for(var r=0,s=o;r<s.length;r++){var c=s[r];n.recordTrace(c.name,c.startTime)}n.logData()})(e),c(e)},t.logBrowserPerformanceInfo=c})),define("modules/clean/perf_tools/web_timing_logger_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(){}return e.getFromNavigation=function(t){switch(t.type){case t.TYPE_NAVIGATE:return e.NAVIGATE;case t.TYPE_RELOAD:return e.RELOAD;case t.TYPE_BACK_FORWARD:return e.BACK_FORWARD}},e.NAVIGATE="navigate",e.RELOAD="reload",e.BACK_FORWARD="back_forward",e})();t.NavigationType=n;var i=(function(){function e(t,n,i,o,r){void 0===i&&(i=!1),void 0===o&&(o=!0),this.name=t,this.flag=1<<n,this.triggersLogging=i,this.timestampPrefix=r||t,this.ordered=o,e.allEvents.push(this)}return e.allEvents=[],e.APPLICATION_START=new e("application_code_start",1),e.LOAD_END=new e("load_end",2,!0,!1),e.MARK_TIME_TO_VIEW=new e("mark_time_to_view",3,!0,!0,"TTV"),e.FETCHED_DATA_FOR_TTI=new e("fetched_data_required_for_tti",4),e.MARK_TIME_TO_INTERACTIVE=new e("mark_time_to_interactive",5),e.TIME_TO_INTERACTIVE=new e("time_to_interactive",6,!0,!0,"TTI"),e})();t.WebTimerEvent=i})),define("modules/clean/perf_tools/web_timing_utils",["require","exports","tslib","modules/core/browser"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importStar(i);var o=(function(){function e(){}return e.generateCorrelationId=function(){return Math.random().toString(36).substring(2)},e.getNow=function(){var e=i.performance();if(e&&e.timing&&e.now){var t=e.timing;return(t.navigationStart||t.fetchStart)+Math.floor(e.now())}return Date.now()},e.newContext=function(t,n){var o;if(void 0===n&&(n="unnamed_timer"),t)o=e.getNow();else{var r=i.performance();if(r&&r.timing){var a=r.timing;o=a.navigationStart||a.fetchStart}else o=e.getNow()}return{initialized:!1,is_pagelet:!1,is_dws:!1,is_dws2:!1,is_early_ensemble:!1,is_page_restore:!1,log_time_to_view:!1,log_time_to_interactive:!1,ttv_at_dom_interactive:!1,tti_at_dom_interactive:!1,source_type:"web",subtypes:{},tti_exclusion_flow:"",have_logged_web_timing:!1,delayed_tti_for_css:!1,timing_results:null,start_time:o,time_to_view:null,time_to_interactive:null,correlation_id:e.generateCorrelationId(),timesStagesWereReached:{},context_name:n}},e})();t.WebTimingUtil=o;var r=(function(){function e(e){this.canceled=!1,this.callback=e}return e.prototype.exec=function(){this.canceled||this.callback()},e.prototype.cancel=function(){this.canceled=!0},e.prototype.isCanceled=function(){return this.canceled},e})();t.CancellableCallback=r})),define("modules/clean/visibility_logging",["require","exports","modules/clean/js_client_stopwatch","modules/clean/js_basic_stopwatch"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logPaintPerformance=function(e){if(window.performance&&window.performance.getEntriesByType){var t=window.performance.getEntriesByType("paint").map((function(e){return{type:i.TimingDataType.Trace,name:e.name,endTime:e.startTime}}));if(t.length>0){var o=n.JSStopwatch.createDetachedStopwatch("paint",e);o.recordEntries(t),o.logData()}}},t.logVisibilityChangeEvents=function(e,t){if(window.performance&&window.performance.getEntriesByType){var o=Number.MAX_VALUE;e.time_to_interactive&&(o=e.time_to_interactive-e.start_time);var r,a=window.performance.getEntriesByType("mark").filter((function(e){return e.name.startsWith("VisibilityState.")})).map((function(e){return{visibility:e.name,time:e.startTime}})),s={"VisibilityState.visible":0,"VisibilityState.hidden":0},c=function(e){r&&r.time<o&&(s[r.visibility]=(s[r.visibility]||0)+Math.min(e,o)-r.time)},p=[];for(var u in a.forEach((function(e,t){c(e.time),p.push({type:i.TimingDataType.Trace,name:"visibility-change-"+t,endTime:e.time,annotations:{visibility:e.visibility}}),r=0===t?{visibility:e.visibility,time:0}:e})),c(window.performance.now()),s)s.hasOwnProperty(u)&&p.push({type:i.TimingDataType.Trace,name:"total-"+u+"-time",endTime:s[u]});var l=n.JSStopwatch.createDetachedStopwatch("visibility",t);l.recordEntries(p),l.logData()}}})),define("modules/clean/web_module_timing",["require","exports","modules/pagelet_config"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get_module_times=function(){var e=n.REQUIREJS_CONTEXT_NAME,t=window.requireContexts[e].module_callback_times,i=[];for(var o in t)if(t.hasOwnProperty(o)){var r=t[o];if(null!=r.loadTime){var a={load_time:r.loadTime,callback_duration:r.callbackDuration,callback_time:r.callbackTime,name:r.name,url:r.url,parent:r.parent};i.push(a)}}return i},t.add_module=function(){}})),define("modules/clean/web_timing_logger",["require","exports","tslib","apex-metrics","modules/clean/metrics/index","modules/clean/devtools/panels/performance/perf_hub_actions","modules/clean/event_load","modules/clean/web_module_timing","modules/clean/window_util","modules/clean/perf_tools/resource_utils","modules/clean/perf_tools/web_timing_logger_types","modules/clean/perf_tools/web_timing_utils","modules/clean/js_client_stopwatch","modules/clean/perf_tools/browser_perf_utils","modules/clean/init_react","modules/clean/perf_tools/cpu_utils","modules/clean/js_basic_stopwatch","modules/constants/request","modules/constants/webtiming","modules/constants/page_load","modules/core/browser","modules/core/exception","modules/core/xhr","dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","modules/clean/visibility_logging"],(function(e,t,n,i,o,r,a,s,c,p,u,l,d,m,_,f,h,g,v,w,b,S,y,T,E){"use strict";var x;Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importStar(a),c=n.__importStar(c),g=n.__importStar(g),v=n.__importStar(v),w=n.__importStar(w),b=n.__importStar(b),S=n.__importStar(S),y=n.__importStar(y),(function(e){e[e.NEW=1]="NEW",e[e.RUNNING=2]="RUNNING",e[e.ABORTED=3]="ABORTED",e[e.CLOSED=4]="CLOSED"})(x||(x={})),t.perfHubClassName="perf-hub-link-container";var k=["navigation_type","referrer","repo_rev","source_type","active_user_id"],O=["tti_flow","tti_exclusion_flow","is_dws2"];function C(){return"hidden"===window.document.visibilityState}var I=[[u.WebTimerEvent.APPLICATION_START,u.WebTimerEvent.MARK_TIME_TO_VIEW,u.WebTimerEvent.FETCHED_DATA_FOR_TTI,u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[u.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse(),N=1;var R=["requirejs_start","ensemble_payload_start","body_start"];var A=["craft_fast_prefetch_done","dws_core_externals_loaded","dws_ensemble_init","dws-processChunk-embedded-app-done-1","dws-processChunk-embedded-app-require_config-1","ensemble_init","module_init","last_js_const_end","pagelet_render_on_page_embedded-app","pagelet_css_loaded_embedded-app"];var D,P=(function(){function e(){d.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger")}return e.prototype.buildBaseParams=function(e,t,n){void 0===n&&(n={});var i=e.start_time,o=e.subtypes||{};e.tti_flow&&(o.tti_flow=e.tti_flow);var r,a,s={log_source:t.name,subtypes:JSON.stringify(o),correlation_id:e.correlation_id};e.extra_columns&&Object.keys(e.extra_columns).forEach((function(t){var n=e.extra_columns[t];n&&(s[t]=n)})),Object.keys(n).forEach((function(e){var t=n[e];t&&(s[e]=t)})),g.IS_HTTP2&&(s.is_spdy=!0),e.is_pagelet&&(s.is_pagelet=!0),e.is_dws&&(s.is_dws=!0),e.is_early_ensemble&&(s.is_early_ensemble=!0),s.delayed_tti_for_css=e.delayed_tti_for_css,""!==e.tti_exclusion_flow&&(s.tti_exclusion_flow=e.tti_exclusion_flow),r=e.log_time_to_view&&null!=e.time_to_view?e.time_to_view-i:null,a=e.log_time_to_interactive&&null!=e.time_to_interactive?e.time_to_interactive-i:null;var c={navigation_type:e.is_page_restore?u.NavigationType.RELOAD:this.get_navigation_type(),server_request_start_time:g.REQUEST_START_TIME,extra_columns:JSON.stringify(s),subtypes:JSON.stringify(o),source_type:e.source_type,page_load_time:e.end_time-e.start_time,repo_rev:w.REPO_REV};if(X(c),e.log_time_to_view&&(c.time_to_view=r),e.log_time_to_interactive&&(c.time_to_interactive=a),c.url=b.get_href(),0===c.url.indexOf("/dws2/")&&(c.url=c.url.substring("/dws2/".length-1)),c.referrer=document.referrer,c.request_id=e.request_id||g.REQUEST_ID,c.request_tracing_enabled=g.REQUEST_TRACING_ENABLED,window.ensemble&&window.ensemble.viewer){var p=window.ensemble.viewer.getActiveUser();p&&(c.active_user_id=p.userId),c.dws_page_name=window.ensemble.getPageName()}return c},e.prototype.get_navigation_type=function(){var e=b.performance();if(e&&e.navigation){var t=e.navigation;return u.NavigationType.getFromNavigation(t)}},e.prototype.log=function(e,n,i){void 0===i&&(i=!1);var o=d.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});d.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",n.navigation_type,{stopwatchName:"web_timing_logger",spanId:o});var a=y.sendXhr("/alternate_wtl",n);a.onreadystatechange=function(e){if(a.readyState===XMLHttpRequest.DONE&&200===a.status){d.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:o});var n=document.getElementsByClassName(t.perfHubClassName);if(i&&n.length){var s=JSON.parse(a.responseText);s.status&&r.PerfHubActions.add_web_timing_details(s)}}}},e})(),M=(function(e){function t(){return e.call(this)||this}return n.__extends(t,e),t.prototype.shouldLog=function(e){return e.initialized&&!e.have_logged_web_timing&&void 0!==e.end_time&&(!e.log_time_to_view||null!=e.time_to_view)&&(!e.log_time_to_interactive||null!=e.time_to_interactive)},t.prototype.logTiming=function(e,t){e.have_logged_web_timing=!0;var n=this.buildBaseParams(e,t),i=B(e,n);return this.log(e,n,!1),i},t.prototype.get_navigation_type=function(){return"ajax"},t})(P),j=(function(e){function t(){var t=e.call(this)||this;return t.metricsReporter=o.getMetricsReporter(),t}return n.__extends(t,e),t.prototype.shouldLog=function(e){if(!e.initialized||e.have_logged_web_timing)return!1;var t=b.performance();if(!t||!t.timing)return!1;var n=t.timing,i=e.start_time,o=e.end_time;return!(!i||!o)&&(!(e.log_time_to_view&&!(e.ttv_at_dom_interactive&&n.domInteractive||null!=e.time_to_view))&&!(e.log_time_to_interactive&&!(e.tti_at_dom_interactive&&n.domInteractive||null!=e.time_to_interactive)))},t.prototype.logTiming=function(e,t){var n=b.performance(),o=n.timing,r=f.getAllGlobalExecutionPerfMeasurements(),a=e.timesStagesWereReached["dws_embedded-app_require_config_callback"];void 0===a?a=e.timesStagesWereReached.application_code_start:e.timesStagesWereReached.hasOwnProperty("application_code_start")&&(a=Math.min(a,e.timesStagesWereReached.application_code_start)),d.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});var s=this.buildBaseParams(e,t,{}),c=B(e,s),l=window.ensemble&&window.ensemble.getJSStopwatchData?window.ensemble.getJSStopwatchData():{},h=n.getEntriesByType?n.getEntriesByType("resource"):[],g=n.getEntriesByType?p.summarizePerformanceResourceTimings(h,a):{pre:{},total:{}};if(s.browser_time=(o.redirectStart||o.fetchStart)-e.start_time,s.redirect_time=o.fetchStart-e.start_time,s.dns_time=o.domainLookupEnd-e.start_time,s.tcp_connect_time=(o.secureConnectionStart||o.requestStart)-e.start_time,s.ssl_connect_time=o.requestStart-e.start_time,s.time_to_first_byte=o.responseStart-e.start_time,s.time_to_last_byte=o.responseEnd-e.start_time,s.dom_load_time=o.domContentLoadedEventEnd-e.start_time,s.idle_cpu_time=e.timing_results?Math.round(e.timing_results.idleCPUTime):void 0,s.total_tracked_cpu_time=e.timing_results?Math.round(e.timing_results.totalTrackedCPUTime):void 0,s.untracked_time_after_first_byte=e.timing_results&&null!=e.timing_results.untrackedTimeAfterFirstByte?Math.round(e.timing_results.untrackedTimeAfterFirstByte):void 0,b.performance().getEntriesByType&&((function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t["resource_"+n+"_count"]=e[n].count,t["resource_"+n+"_avg_time"]=e[n].total_time/e[n].count||1,void 0!==e[n].total_size&&(t["resource_"+n+"_total_size"]=e[n].total_size),void 0!==e[n].transfer_size&&(t["resource_"+n+"_transfer_size"]=e[n].transfer_size))})(g.total,s),(function(e,t){var n;for(n in e)if(e.hasOwnProperty(n)){var i=e[n];for(var o in i)if(i.hasOwnProperty(o)){var r=i[o].transfer_size,a=i[o].total_size,s=i[o].count,c=i[o].total_time;if(t.recordTrace(n+"_"+o+"_count",s),t.recordTrace(n+"_"+o+"_total_time",c),void 0!==r&&void 0!==a&&a>0){var p=r/a;t.recordTrace(n+"_"+o+"_transferred_size",r),t.recordTrace(n+"_"+o+"_total_size",a),t.recordTrace(n+"_percent_"+o+"_transferred",100*p)}t.recordTrace(n+"_last_"+o+"_transfer_end",i[o].last_transfer_end)}}t.logData()})(g,d.JSStopwatch.createDetachedStopwatch("resources_percent_transferred",c)),d.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"})),X(s),d.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),d.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),e.is_pagelet&&Object.getOwnPropertyNames(l).length>0&&(function(e,t,n){var i=(function(e,t){var n=f.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),i=d.JSStopwatch.createDetachedStopwatch("ensemble",e),o=n.map((function(e){var t=e.measurement,n=e.annotations;return{name:t.name,startTime:t.startTime,endTime:t.startTime+t.totalTime,annotations:n}}));return H(i,o),i})(n,t),o=void 0,r=void 0;for(var a in t)t.hasOwnProperty(a)&&(K.includes(a)&&(e.timesStagesWereReached[a]=t[a].start),["ensemble_init","dws_embedded-app_require_config_callback"].includes(a)&&(o=o?Math.min(o,t[a].end):t[a].end),Y.test(a)&&(r=r?Math.max(r,t[a].end):t[a].end));r&&i.recordTrace("last_js_const_end",r);o&&i.recordTrace("module_init",o)})(e,l,c),m.logBrowserPerfData(c),(function(e,t,n){f.logCumulativeExecutionTimes(e,f.cumulativeExecutionTimesBefore(t,n))})(c,e.timesStagesWereReached,r),this.get_navigation_type()===u.NavigationType.NAVIGATE&&((function(e){var t=_.getReactInitData();H(d.JSStopwatch.createDetachedStopwatch("init_react",e),t)})(c),p.logResourcesData(c)),d.JSStopwatch.log_stored_results(),(function(e,t){return!e.is_page_restore&&(t.navigation_type===u.NavigationType.NAVIGATE||"ajax"===t.navigation_type)})(e,s)){var v=(function(e,t){var n={is_dws:String(e.is_dws),source_type:String(e.source_type)},i="";return e.subtypes.amp_tti_flow?i=e.subtypes.amp_tti_flow:t.dws_page_name&&(i="dws_page_name:"+t.dws_page_name),""!==i&&(n.product=i),t.navigation_type&&(n.navigation_type=t.navigation_type),n})(e,s),w=this.metricsReporter.child(v);(function(e,t){e.time_to_interactive&&t.createStats({ns:"web_timing",name:"temp/time-to-interactive"}).recordDuration(e.time_to_interactive,i.TimeUnit.MILLISECONDS)})(s,w),(function(e,t){var n;for(n in e)if(e.hasOwnProperty(n)){var o=e[n];for(var r in o)if(o.hasOwnProperty(r)){var a=o[r],s=a.transfer_size,c=a.total_size,p=a.count,u=a.total_time,l=a.last_transfer_end;t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+r+"/count"}).record(p),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+r+"/total-time"}).recordDuration(u,i.TimeUnit.MILLISECONDS),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+r+"/last-transfer-end"}).recordDuration(l,i.TimeUnit.MILLISECONDS),void 0!==s&&void 0!==c&&c>0&&(t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+r+"/transferred-size"}).record(s),t.createStats({ns:"web_timing",name:"temp/resources/"+n+"/"+r+"/total-size"}).record(c))}}})(g,w),e.is_pagelet&&Object.getOwnPropertyNames(l).length>0&&(function(e,t,n){var o=f.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),r=void 0,a=void 0;o.forEach((function(t){var o=t.measurement,s=o.startTime+o.totalTime;-1!==A.indexOf(o.name)&&n.createStats({ns:"web_timing",name:"temp/ensemble-timing/"+o.name}).recordDuration(s,i.TimeUnit.MILLISECONDS),K.includes(o.name)&&(e.timesStagesWereReached[o.name]=o.startTime),["ensemble_init","dws_embedded-app_require_config_callback"].includes(o.name)&&(r=r?Math.min(r,s):s),Y.test(o.name)&&(a=a?Math.max(a,s):s)})),void 0!==a&&n.createStats({ns:"web_timing",name:"temp/last-js-const-end"}).recordDuration(a,i.TimeUnit.MILLISECONDS),void 0!==r&&n.createStats({ns:"web_timing",name:"temp/module-init"}).recordDuration(r,i.TimeUnit.MILLISECONDS)})(e,l,w),n&&n.getEntriesByType&&((function(e,t){e.getEntriesByType("mark").filter((function(e){return R.indexOf(e.name)>-1})).forEach((function(e){t.createStats({ns:"web_timing",name:"temp/browser-perf/marks/"+e.name}).recordDuration(e.startTime,i.TimeUnit.MILLISECONDS)}))})(n,w),(function(e,t){var n=e.getEntriesByType("navigation")[0],o=void 0===n?null:n;o&&([["temp/browser-perf/navigation/unload-event-start",o.unloadEventStart],["temp/browser-perf/navigation/unload-event-end",o.unloadEventEnd],["temp/browser-perf/navigation/dom-interactive",o.domInteractive],["temp/browser-perf/navigation/dom-content-loaded-event-start",o.domContentLoadedEventStart],["temp/browser-perf/navigation/dom-content-loaded-event-end",o.domContentLoadedEventEnd],["temp/browser-perf/navigation/dom-complete",o.domComplete],["temp/browser-perf/navigation/load-event-start",o.loadEventStart],["temp/browser-perf/navigation/load-event-end",o.loadEventEnd],["temp/browser-perf/navigation/redirect-count",o.redirectCount],["temp/browser-perf/navigation/worker-start",o.workerStart],["temp/browser-perf/navigation/redirect-start",o.redirectStart],["temp/browser-perf/navigation/redirect-end",o.redirectEnd],["temp/browser-perf/navigation/fetch-start",o.fetchStart],["temp/browser-perf/navigation/domain-lookup-start",o.domainLookupStart],["temp/browser-perf/navigation/domain-lookup-end",o.domainLookupEnd],["temp/browser-perf/navigation/connect-start",o.connectStart],["temp/browser-perf/navigation/connect-end",o.connectEnd],["temp/browser-perf/navigation/secure-connect-start",o.secureConnectionStart],["temp/browser-perf/navigation/request-start",o.requestStart],["temp/browser-perf/navigation/response-start",o.responseStart],["temp/browser-perf/navigation/response-end",o.responseEnd],["temp/browser-perf/navigation/transfer-size",o.transferSize]].forEach((function(e){var n=e[0],o=e[1];"number"==typeof o&&t.createStats({ns:"web_timing",name:n}).recordDuration(o,i.TimeUnit.MILLISECONDS)})),[["temp/browser-perf/navigation/encoded-body-size",o.encodedBodySize],["temp/browser-perf/navigation/decoded-body-size",o.decodedBodySize]].forEach((function(e){var n=e[0],i=e[1];"number"==typeof i&&t.createStats({ns:"web_timing",name:n}).record(i)})))})(n,w))}return E.logPaintPerformance(c),E.logVisibilityChangeEvents(e,c),e.have_logged_web_timing=!0,this.log(e,s,!0),c},t.prototype.log=function(t,n,i){void 0===i&&(i=!1),e.prototype.log.call(this,t,n,i)},t})(P),L=(function(){function e(e,t,n,i){this.childSpans=[],this.spanName=e,this.startTime=void 0!==n?n:l.WebTimingUtil.getNow(),this.originTs=t,this.startTimeOffsetMS=this.startTime-t,this.endCallback=i}return e.prototype.startSpan=function(t){var n=new e(t,this.originTs);return this.childSpans.push(n),n},e.prototype.markSpan=function(t,n){var i=new e(t,this.originTs,this.startTime);this.childSpans.push(i),i.endSpan(n)},e.prototype.endSpan=function(e){var t=this;this.endTime=void 0!==e?e:l.WebTimingUtil.getNow(),this.childSpans.forEach((function(e){e.hasEnded()||e.endSpan(t.endTime)})),this.endCallback&&this.endCallback(this)},e.prototype.getEndTimeOffsetMS=function(){return void 0!==this.endTime?this.endTime-this.originTs:void 0},e.prototype.hasEnded=function(){return void 0!==this.endTime},e})(),U=(function(){function e(e,t,n,i){void 0===i&&(i=!1),this.timerState=x.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=e,this.timingStopwatch=t,this.userStopwatch=n,this.id=N++,this.strictAssert=i}return e.prototype.startSpan=function(e){var t=this,n=new L(e,this.context.start_time,void 0,(function(e){t.endSpan(e)}));return this.activeSpans.push(n),n},e.prototype.markSpan=function(e,t){if(void 0===t&&(t={}),this.userStopwatch){var n=void 0===t.startTime?0:t.startTime,i=this.timeSinceStart(t.endTime),o=this.userStopwatch.startSpan(e,{startTime:n});this.userStopwatch.endSpan(e,{spanId:o,endTime:i})}else{var r=new L(e,this.context.start_time,t.startTime);r.endSpan(t.endTime),this.endedSpans.push(r)}},e.prototype.endSpan=function(e){var t=this.activeSpans.indexOf(e);t>=0&&(delete this.activeSpans[t],this.userStopwatch?this.recordSpan(e):this.endedSpans.push(e))},e.prototype.recordSpan=function(e){var t=this,n=this.userStopwatch.startSpan(e.spanName,{startTime:e.startTimeOffsetMS});e.childSpans.forEach((function(e){t.recordSpan(e)})),this.userStopwatch.endSpan(e.spanName,{spanId:n,endTime:e.getEndTimeOffsetMS()})},e.prototype.getContextName=function(){return this.context.context_name},e.prototype.applicationStart=function(){this.logEvent(u.WebTimerEvent.APPLICATION_START)},e.prototype.fetchedDataRequiredForTTI=function(){this.logEvent(u.WebTimerEvent.FETCHED_DATA_FOR_TTI)},e.prototype.startTime=function(){return this.context.start_time},e.prototype.timeSinceStart=function(e){return(e||l.WebTimingUtil.getNow())-this.context.start_time},e.prototype.timeToView=function(){return this.context.time_to_view},e.prototype.timeToInteractive=function(){return this.context.time_to_interactive},e.prototype.reportTTIAfterPaint=function(){var e=this,t=new l.CancellableCallback((function(){e.reportTTI()}));return window.requestAnimationFrame((function(){window.requestAnimationFrame((function(){t.exec()}))})),t},e.prototype.setExtraColumns=function(e){this.context.extra_columns=e},e.prototype.excludeFromTTI=function(e){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+e},e.prototype.logEvent=function(e,t){this.logEventInternal(e,!0,t)},e.prototype.logSilentEvent=function(e,t){this.logEventInternal(e,!1,t)},e.prototype.logEventInternal=function(e,t,n){this.loggedEvents|=e.flag,e.ordered&&this.validateEventOrder(e);var i=this.timeSinceStart(n);this.context.timesStagesWereReached[e.name]=i,this.timingStopwatch.recordTrace(e.name,i),console.timeStamp&&console.timeStamp(e.timestampPrefix);var o=b.performance();o&&"function"==typeof o.mark&&o.mark(e.name),t&&e.triggersLogging&&this.logIfReady(e)},e.prototype.validateEventOrder=function(e){for(var t=0,n=0,i=I;n<i.length;n++){var o=i[n];if(o.includes(e))break;for(var r=0,a=o;r<a.length;r++){t|=a[r].flag}}var s=t&this.loggedEvents;if(s>0){var c=u.WebTimerEvent.allEvents.filter((function(e){return(e.flag&s)>0})).map((function(e){return e.name}));this.reportSwMisuse("Received "+e.name+" after ["+c.join(",")+"]")}},e.prototype.logIfReady=function(e){if(this.logger.shouldLog(this.context)){this.addEventBasedTiming();var t=this.logger.logTiming(this.context,e);V(this.timingStopwatch,t),V(this.userStopwatch,t),this.timingStopwatch.logData(),this.userStopwatch.logData(),this.timerState=x.CLOSED}},e.prototype.addEventBasedTiming=function(){var e=b.performance().timing;this.context.ttv_at_dom_interactive&&(this.context.is_pagelet&&window.ensemble?this.context.time_to_view=window.ensemble.getEmbeddedAppDOMInteractive():this.context.time_to_view=e.domInteractive,this.logSilentEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),this.context.tti_at_dom_interactive&&(this.context.time_to_interactive=e.domInteractive,this.logSilentEvent(u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE,this.context.time_to_interactive),this.logSilentEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive))},e.prototype.reportSwMisuse=function(e){e="WebTimer: "+e,this.strictAssert?S.assert(!1,e):S.reportStack(e,{severity:S.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})},e})(),W=(function(e){function t(t){var n=e.call(this,t,d.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:t.correlation_id}),d.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:t.correlation_id}),!1)||this;return n.logger=new M,n}return n.__extends(t,e),t.prototype.initialize=function(e){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.tti_flow=e.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)},t.prototype.start=function(){this.isUsable()&&this.timerState===x.NEW&&(this.context.start_time=l.WebTimingUtil.getNow(),this.timerState=x.RUNNING)},t.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.have_logged_web_timing=!1,this.context.correlation_id=l.WebTimingUtil.generateCorrelationId(),this.context.start_time=l.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=x.RUNNING,d.JSStopwatch.deleteStopwatch(this.timingStopwatch),this.timingStopwatch=d.JSStopwatch.createDetachedStopwatch("maestro_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id}),d.JSStopwatch.deleteStopwatch(this.userStopwatch),this.userStopwatch=d.JSStopwatch.createDetachedStopwatch("user_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id})},t.prototype.abort=function(){this.timerState!==x.CLOSED&&(this.timerState=x.ABORTED)},t.prototype.markTimeToView=function(){this.isUsable()&&(null==this.context.time_to_view&&(this.context.time_to_view=l.WebTimingUtil.getNow()),this.logEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW))},t.prototype.markTimeToInteractive=function(){this.isUsable()&&(this.logEvent(u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),C()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},t.prototype.reportTTI=function(){null==this.context.time_to_interactive&&(this.context.time_to_interactive=l.WebTimingUtil.getNow(),this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE),Q(this.id))},t.prototype.end=function(e){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=l.WebTimingUtil.getNow()),this.context.request_id=e,this.timingStopwatch.request_id=e,this.userStopwatch.request_id=e,this.logEvent(u.WebTimerEvent.LOAD_END))},t.prototype.waitForTTI=function(e){var t=this;return new Promise((function(n,i){if(null==t.context.time_to_interactive){var o,r=function(e){window.removeEventListener("TTI."+t.id,r),clearTimeout(o),n()};window.addEventListener("TTI."+t.id,r),e&&void 0!==e.timeoutMS&&(o=setTimeout(r,e.timeoutMS))}else n()}))},t.prototype.isUsable=function(){return this.timerState===x.NEW||this.timerState===x.RUNNING},t})(U),q=(function(t){function i(e){var n=t.call(this,e,d.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),d.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1)||this;return n.logger=new j,n}return n.__extends(i,t),i.prototype.initialize=function(e){var t=this;if(!this.context.initialized){if(!b.performance())return;this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.is_pagelet=!!e.is_pagelet,this.context.is_dws=!!e.is_dws,this.context.is_dws2=!!e.is_dws2,this.context.is_early_ensemble=!!e.is_early_ensemble,this.context.is_page_restore=!1,this.context.ttv_at_dom_interactive=!!e.ttv_at_dom_interactive,this.context.tti_at_dom_interactive=!!e.tti_at_dom_interactive,this.context.source_type=null!=e.source_type?e.source_type:"web",this.context.subtypes=null!=e.subtypes?e.subtypes:{},this.context.tti_exclusion_flow=null!=e.tti_exclusion_flow?e.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.initialized=!0,e.url&&(this.context.tti_flow=e.url,this.timingStopwatch.url=e.url,this.userStopwatch.url=e.url),this.context.subtypes.tti_flow&&(this.context.tti_flow=this.context.subtypes.tti_flow);var n=0;v.LOG_TIMING_DELAY&&(n=600),d.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),a.window_load((function(){setTimeout((function(){return t.end()}),n)})),c.onPageRestore((function(e){t.context.is_page_restore=!0;var n=d.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:t.context.correlation_id});n.recordTrace("page_restore"),n.logData()})),!this.context.ttv_at_dom_interactive&&window._timingData&&(null!=window._timingData.ttv&&(this.context.time_to_view=window._timingData.ttv.getTime(),this.logEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),null!=window._timingData.tti&&(this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Q()))}},i.prototype.start=function(){this.isUsable()&&this.timerState===x.NEW&&(this.timerState=x.RUNNING)},i.prototype.restart=function(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.correlation_id=l.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=x.RUNNING,this.timingStopwatch=d.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=d.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})},i.prototype.abort=function(){this.timerState!==x.CLOSED&&(this.timerState=x.ABORTED)},i.prototype.markTimeToView=function(){this.isUsable()&&(null!=this.context.time_to_view||this.context.ttv_at_dom_interactive||(window._timingData&&null!=window._timingData.ttv?this.context.time_to_view=window._timingData.ttv.getTime():this.context.time_to_view=l.WebTimingUtil.getNow(),this.logEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)))},i.prototype.markTimeToInteractive=function(){var e=this;if(window.ensemble&&window.ensemble.waitingForCss)return this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=function(){e.markTimeToInteractive()});null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),C()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())},i.prototype.reportTTI=function(){var t=this;null==this.context.time_to_interactive&&(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=l.WebTimingUtil.getNow(),console.timeStamp&&console.timeStamp("TTI"),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),window.RUNNING_IN_EDISON?new Promise((function(t,n){e(["modules/clean/edison/edison"],t,n)})).then(n.__importStar).then((function(e){for(var i=e.Edison.getPrefetchCounts(),o={},r=0,a=Object.keys(i);r<a.length;r++){var s=a[r];o[s]=i[s].toString()}t.context.subtypes=n.__assign(n.__assign({},o),t.context.subtypes),t.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,t.context.time_to_interactive),Q()})):(this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),Q()))},i.prototype.end=function(e){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=l.WebTimingUtil.getNow(),this.logEvent(u.WebTimerEvent.LOAD_END),this.context.tti_at_dom_interactive&&Q())},i.prototype.waitForTTI=function(e){var t=this;return new Promise((function(n,i){if(window.ensemble){if(window.ensemble.ttiMarked)return void n()}else if(null!=t.context.time_to_interactive)return void n();var o,r=function(e){window.removeEventListener("TTI",r),clearTimeout(o),n()};window.addEventListener("TTI",r),e&&void 0!==e.timeoutMS&&(o=setTimeout(r,e.timeoutMS))}))},i.prototype.isUsable=function(){return this.timerState===x.NEW||this.timerState===x.RUNNING},i})(U),F={};function B(e,t){for(var n={},i=0,o=k;i<o.length;i++){(p=t[c=o[i]])&&(n[c]=String(p))}for(var r=e,a=0,s=O;a<s.length;a++){var c,p;(p=r[c=s[a]])&&(n[c]=String(p))}return{correlation_id:e.correlation_id,request_id:t.request_id,annotations:n}}function V(e,t){if(t.annotations)for(var n in t.annotations)if(t.annotations.hasOwnProperty(n)){var i=t.annotations[n];i&&e.addAnnotation(n,String(i))}t.correlation_id&&e.addAnnotation(d.ReservedAnnotationKey.CORRELATION_ID.id,t.correlation_id),t.request_id&&e.addAnnotation(d.ReservedAnnotationKey.REQUEST_ID.id,t.request_id),t.url&&e.addAnnotation(d.ReservedAnnotationKey.URL.id,t.url)}function z(e){return e?(function(e){var t=e;return F[t]||(F[t]=new W(l.WebTimingUtil.newContext(!0,e))),F[t]})(e):(D||G(),D)}function J(e){void 0===e&&(e={}),z().initialize({requireTTV:!!e.log_time_to_view,requireTTI:!!e.log_time_to_interactive,is_pagelet:e.is_pagelet,is_dws:e.is_dws,is_dws2:e.is_dws2,is_early_ensemble:e.is_early_ensemble,ttv_at_dom_interactive:e.ttv_at_dom_interactive,tti_at_dom_interactive:e.tti_at_dom_interactive,source_type:e.source_type,subtypes:e.subtypes,tti_exclusion_flow:e.tti_exclusion_flow,url:e.url})}function G(){D=new q(l.WebTimingUtil.newContext(!1,"default_timer"))}function H(e,t){e.recordEntries(t.map((function(e){return{type:0!==e.startTime?h.TimingDataType.Span:h.TimingDataType.Trace,name:e.name,startTime:e.startTime,endTime:e.endTime,annotations:e.annotations}}))),e.logData()}G(),t.get_timer=z,t.delete_timer=function(e){delete F[e]},t.time_to_view=function(){return z().timeToView()},t.time_to_interactive=function(){return z().timeToInteractive()},t.initialize_module=J,t.initialize=function(e,t){var i,o=t.dwsOpts;switch(t.sourceType){case T.web_timing_logger.WebTimingLoggerServerContext.SourceType.UNKNOWN:i="unknown";break;case T.web_timing_logger.WebTimingLoggerServerContext.SourceType.MOBILE_WEB:i="mobile";break;case T.web_timing_logger.WebTimingLoggerServerContext.SourceType.DESKTOP_WEB:i="web"}var r={is_pagelet:t.isDws,is_dws:t.isDws,is_dws2:null!=o&&o.isDws2,is_early_ensemble:null!=o&&o.isEarlyEnsemble,subtypes:n.__assign(n.__assign({},t.subtypes),{js_preloading:null!=o&&o.jsPreloading?"true":"false"}),source_type:i,url:t.url};J(n.__assign(n.__assign({},r),e))},t.reset=G,t.start_time=function(){return z().startTime()},t.time_since_start=function(){return z().timeSinceStart()},t.set_tti_exclusion_flow=function(e){z().excludeFromTTI(e)};var K=["ensemble_init","dws_ensemble_init","dws_embedded-app_require_config_callback","dws-processChunk-embedded-app-require_config-1"],Y=new RegExp("dws-processChunk-embedded-app-const_module.*");function X(e){var t=b.performance();if(t&&t.getEntriesByName){for(var n=[],i=0,o=s.get_module_times();i<o.length;i++){var r=o[i],a=r.url;if(void 0===a&&r.name&&-1===r.name.indexOf("!"))S.reportStack("Module "+r.name+" with invalid map object fetched by requirejs",{severity:S.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});else{var c=[];if(a&&(c=t.getEntriesByName(a,"resource")),0!==c.length)r.start_time=c[0].startTime+c[0].duration;else{if(!("callback_duration"in r))continue;r.start_time=0}n.push(r)}}e.js_module_times=JSON.stringify(n)}}function Q(e){if(window.ensemble&&window.ensemble.markTTI)window.ensemble.markTTI();else{var t=document.createEvent("Event");null!=e?t.initEvent("TTI."+e,!0,!0):t.initEvent("TTI",!0,!0),window.dispatchEvent(t)}}t.mark_time_to_view=function(){z().markTimeToView()},t.mark_time_to_interactive=function(e){void 0===e&&(e={});var t=z();t.setExtraColumns(e),t.markTimeToInteractive()},t.waitForTTI=function(e){return z().waitForTTI(e)},t.log_js_modules_application_code_start=function(){z().applicationStart()},t.log_js_modules_fetched_data_required_for_tti=function(){z().fetchedDataRequiredForTTI()}})),define("modules/clean/window_util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onBeforeUnload=function(e){window.addEventListener("beforeunload",(function t(){e(),window.removeEventListener("beforeunload",t)}))},t.onPageRestore=function(e){window.addEventListener("pageshow",(function t(n){n.persisted&&(e(),window.removeEventListener("pageshow",t))}))}})),define("modules/clean/js_basic_stopwatch",["require","exports","tslib","modules/core/exception"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=!(!window.performance||!window.performance.now),a=0;(function(e){e[e.Span=1]="Span",e[e.AsyncSpan=2]="AsyncSpan",e[e.Trace=3]="Trace"})(o=t.TimingDataType||(t.TimingDataType={}));var s=(function(){function e(e,t,i,o,r){void 0===o&&(o=!1),this.name=e,this.strictAssert=t,this.activeSpans={},this.aggregateSpans={},this._annotations=n.__assign({},r),this.spanStack=[],this.stopwatchTags=i||[],this.detached=o}return e.prototype.reset=function(){this.activeSpans={},this.spanStack=[],this.aggregateSpans={},this._annotations={}},Object.defineProperty(e.prototype,"annotations",{get:function(){return this._annotations},enumerable:!0,configurable:!0}),e.prototype.addAnnotation=function(e,t){this._annotations[e]=t},e.prototype.removeAnnotation=function(e){delete this._annotations[e]},e.prototype.popResolvedSpans=function(){if(this.detached)return{};var e=this.aggregateSpans;return this.aggregateSpans={},e},e.prototype.peekResolvedSpans=function(){return this.detached?{}:this.aggregateSpans},e.newSpanID=function(){var e=String(a);return a++,e},e.resolveTime=function(e){return void 0===e&&(e=window.performance.now()),Math.round(e)},e.prototype._resolveParent=function(e){if(e.type===o.Span){var t=this.spanStack[this.spanStack.length-1];if(t)if(t!==e.name)this._report_sw_misuse("Closing "+t+" while the latest open span is "+e.name+".\n        You are either mixing sync and async spans or closing sync spans out of order.");else{this.spanStack.pop();for(var n="",i=0,r=this.spanStack;i<r.length;i++){n+=r[i]+"#"}e.parent=n}else this._report_sw_misuse(e.name+' isn\'t a synchronous span and has to be started with "async:true".')}else e.parent=""},e.prototype.recordTrace=function(t,i){void 0===i&&(i={});var r=e.resolveTime(i.traceTime),a=e.newSpanID(),s={name:t,span_id:a,start_time:0,end_time:r,annotations:n.__assign({},i.annotations),type:o.Trace,parent:""};return this.recordSpan(this.stopwatchTags,s),a},e.prototype.start=function(t,i){void 0===i&&(i={}),t||this._report_sw_misuse("Reporting a span without a name");var r=e.resolveTime(i.startTime);i.async||this.spanStack.push(t);var a=e.newSpanID(),s={name:t,span_id:a,start_time:r||0,annotations:n.__assign({},i.annotations),type:i.async?o.AsyncSpan:o.Span};return t in this.activeSpans||(this.activeSpans[t]=[]),this.activeSpans[t].push(s),a},e.prototype.end=function(t,n){void 0===n&&(n={});var i=this.findTimerDataIndex(t,n.spanId);if(-1!==i){var o=this.activeSpans[t],r=o[i];o.splice(i,1),this._resolveParent(r);var a=e.resolveTime(n.endTime);if(!(a<r.start_time))return r.end_time=a,this.recordSpan(this.stopwatchTags,r),r.span_id;this._report_sw_misuse("span "+t+" has set an endTime earlier than start_time")}},e.prototype.addSpanAnnotation=function(e,t,n,i){var o=this.findTimerDataIndex(e,i);-1!==o&&(this.activeSpans[e][o].annotations[t]=n)},e.prototype.attach=function(){this.detached=!1},e.prototype.findTimerDataIndex=function(e,t){if(!(e in this.activeSpans)||0===this.activeSpans[e].length)return this._report_sw_misuse("tried to find "+e+" but that span doesn't exist"),-1;var n=-1,i=this.activeSpans[e];if(void 0===t)n=0;else for(var o=0;o<i.length;o++)if(i[o].span_id===t){n=o;break}return-1===n&&this._report_sw_misuse("tried to find "+e+" with id "+t+" but that span doesn't exist"),n},e.prototype._report_sw_misuse=function(e){e="JSBasicStopwatch "+this.name+": "+e,this.strictAssert?i.assert(!1,e):i.reportStack(e,{severity:i.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},e.prototype.recordSpan=function(e,t){var n=""+t.parent+t.name;n in this.aggregateSpans||(this.aggregateSpans[n]={name:t.name,start_time:t.start_time,total_time:0,num_calls:0,annotations:Object.keys(t.annotations).length>0?t.annotations:void 0,parent:t.parent||"",stopwatch_tags:e.length>0?e:void 0,type:t.type});var i=this.aggregateSpans[n];if(void 0!==t.end_time){if(i.type===o.Trace?(i.total_time=t.end_time-t.start_time,i.num_calls=1):(i.total_time+=t.end_time-t.start_time,i.num_calls+=1),Object.keys(t.annotations).length>0)if(i.annotations)for(var r in t.annotations)t.annotations.hasOwnProperty(r)&&(i.annotations[r]=t.annotations[r]);else i.annotations=t.annotations}else this._report_sw_misuse("Span "+n+" reported with undefined end_time")},e})();t.JSBasicStopwatchImpl=s;var c=(function(){function e(){this.name="",this.annotations={}}return e.prototype.reset=function(){},e.prototype.attach=function(){},e.prototype.addAnnotation=function(e,t){},e.prototype.removeAnnotation=function(e){},e.prototype.popResolvedSpans=function(){return{}},e.prototype.peekResolvedSpans=function(){return{}},e.prototype.start=function(e,t){},e.prototype.end=function(e,t){},e.prototype.recordTrace=function(e,t){},e.prototype.addSpanAnnotation=function(e,t,n,i){},e})();t.NoopStopwatchInstance=new c,t.createStopwatch=function(e,n,i,o,a){return void 0===o&&(o=!1),r?new s(e,n,i,o,a):t.NoopStopwatchInstance}})),define("modules/clean/js_client_stopwatch",["require","exports","tslib","modules/core/xhr","modules/clean/js_basic_stopwatch","modules/constants/request","modules/core/browser","modules/core/exception"],(function(e,t,n,i,o,r,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),a=n.__importStar(a);var c=(function(){function e(e){this.id=e}return e.REQUEST_ID=new e("dropbox.js_client_stopwatch.request_id"),e.CORRELATION_ID=new e("dropbox.js_client_stopwatch.correlation_id"),e.URL=new e("dropbox.js_client_stopwatch.url"),e})();t.ReservedAnnotationKey=c;var p=(function(){function e(){this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.debugEnabled=!0,this.strictAssert=!1,this.intervalId=null,this.clientStopwatchCounter=1,this.reset()}return e.prototype.reset=function(){this.globalStopwatches={},this.clientStopwatches={},this.clientStopwatchCounter=1,this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null},e.prototype.reset_individual_stopwatch=function(e){this.stopwatch_exists(e)?this.globalStopwatches[e].reset():this._report_sw_misuse("tried to reset the stopwatch "+e+" but it does not exist")},e.prototype.stopwatch_exists=function(e){return e in this.globalStopwatches},e.prototype.create_stopwatch=function(e,t){this.stopwatch_exists(e)?this._report_sw_misuse("tried to create a new stopwatch "+e+" but it already exists"):this.globalStopwatches[e]=o.createStopwatch(e,this.strictAssert,t)},e.prototype.createDetachedStopwatch=function(e,t){void 0===t&&(t={});var n=o.createStopwatch(e,this.strictAssert,t.tags,!0,t.annotations),i=new u(this.clientStopwatchCounter++,e,n,t.request_id,t.correlation_id,t.url);return this.clientStopwatches[i.id]=i,i},e.prototype.deleteStopwatch=function(e){delete this.clientStopwatches[e.id]},e.prototype.create_stopwatch_if_not_exist=function(e,t){this.stopwatch_exists(e)||this.create_stopwatch(e,t)},e.prototype.getStopwatch=function(e){return this.stopwatch_exists(e)?this.globalStopwatches[e]:(this._report_sw_misuse(e+" doesn't exist"),null)},e.prototype.recordTrace=function(e,t){void 0===t&&(t={});var n=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){var i={traceTime:t.traceTime};return n.recordTrace(e,i)}},e.prototype.startSpan=function(e,t){void 0===t&&(t={});var n=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n){var i={startTime:t.startTime,async:t.async};return n.start(e,i)}},e.prototype.endSpan=function(e,t){void 0===t&&(t={});var n=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=n)return n.end(e,{spanId:t.spanId,endTime:t.endTime})},e.prototype.addSpanAnnotation=function(e,t,n,i){void 0===i&&(i={});var o=this.getStopwatch(i.stopwatchName||this.GLOBAL_SW_NAME);null!=o&&o.addSpanAnnotation(e,t,n,i.spanId)},e.prototype.log_stored_results=function(){this.sentInitialData?this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval))},e.prototype._report_sw_misuse=function(e){e="ClientStopwatch: "+e,this.strictAssert?s.assert(!1,e):s.reportStack(e,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},e.prototype.flush_current_data=function(){for(var t in this.globalStopwatches)this.globalStopwatches.hasOwnProperty(t)&&e.logStopwatchData(this.globalStopwatches[t]);for(var t in this.clientStopwatches)this.clientStopwatches.hasOwnProperty(t)&&e.logStopwatchData(this.clientStopwatches[t].stopwatch)},e.logStopwatchData=function(t){var n=t.popResolvedSpans(),i=t.name,o={};if(Object.keys(n).length>e.MAXSPANS){var r=0;for(var a in o[i]={},n)n.hasOwnProperty(a)&&(o[i][a]=n[a],r===e.MAXSPANS&&(o[i].annotations=t.annotations,e.send_spans(o),r=0,o[i]={}),r++)}else o[i]=n;0!==Object.keys(o[i]).length&&(o[i].annotations=t.annotations,e.send_spans(o))},e.send_spans=function(e){var t=JSON.stringify(e),n={request_id:r.REQUEST_ID,url:a.get_href().replace("/dws2",""),aggregated_sw_data:t};i.sendXhr("/log_js_sw_data",n)},e.prototype.print_stopwatches_debug=function(){var e=this.get_debug_data();console.table&&console.groupCollapsed&&console.groupEnd&&e&&e.length>0&&(console.groupCollapsed("Request timeline"),console.table(e),console.groupEnd())},e.prototype.get_debug_data=function(){var e=[];for(var t in this.globalStopwatches)if(this.globalStopwatches.hasOwnProperty(t)){var n=this.globalStopwatches[t].peekResolvedSpans();for(var i in n)if(n.hasOwnProperty(i)){var r=n[i],a={stopwatchName:t,spanName:r.name,time:r.start_time+r.total_time};r.type!==o.TimingDataType.AsyncSpan&&r.type!==o.TimingDataType.Span||(a.startTime=r.start_time),r.type===o.TimingDataType.Span&&(a.info="Total time: "+r.total_time+"ms"),e.push(a)}}return e.sort((function(e,t){return e.time-t.time})),e},e.MAXSPANS=2e3,e})();t.JSStopwatch=new p;var u=(function(){function e(e,t,n,i,o,r){this.sentInitialData=!1,this.strictAssert=!1,this.id=e,this.stopwatch=n,this._request_id=i,this._correlation_id=o,this._url=r,this._request_id&&this.stopwatch.addAnnotation(c.REQUEST_ID.id,this._request_id),this._correlation_id&&this.stopwatch.addAnnotation(c.CORRELATION_ID.id,this._correlation_id),this._url&&this.stopwatch.addAnnotation(c.URL.id,this._url)}return Object.defineProperty(e.prototype,"request_id",{set:function(e){this._request_id=e,this._request_id?this.stopwatch.addAnnotation(c.REQUEST_ID.id,this._request_id):this.stopwatch.removeAnnotation(c.REQUEST_ID.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"correlation_id",{set:function(e){this._correlation_id=e,this._correlation_id?this.stopwatch.addAnnotation(c.CORRELATION_ID.id,this._correlation_id):this.stopwatch.removeAnnotation(c.CORRELATION_ID.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{set:function(e){this._url=e,this._url?this.stopwatch.addAnnotation(c.URL.id,this._url):this.stopwatch.removeAnnotation(c.URL.id)},enumerable:!0,configurable:!0}),e.prototype.startSpan=function(e,t){return this.stopwatch.start(e,t)},e.prototype.endSpan=function(e,t){return this.stopwatch.end(e,t)},e.prototype.addSpanAnnotation=function(e,t,n,i){this.stopwatch.addSpanAnnotation(e,t,n,i)},e.prototype.recordTrace=function(e,t,n){this.stopwatch.recordTrace(e,{traceTime:t,annotations:n})},e.prototype.recordEntries=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];if(i.type===o.TimingDataType.Trace)this.recordTrace(i.name,i.endTime,i.annotations);else{var r=i.startTime||0,a=this.startSpan(i.name,{startTime:Math.min(r,i.endTime),async:i.type===o.TimingDataType.AsyncSpan,annotations:i.annotations});i.endTime<r&&this.addSpanAnnotation(i.name,"negativeSpanLength",(i.endTime-r).toString(),a),this.endSpan(i.name,{spanId:a,endTime:Math.max(r,i.endTime)})}}},e.prototype.logData=function(){this.sentInitialData?this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.stopwatch.attach(),this.sentInitialData=!0,setTimeout((function(){t.JSStopwatch.flush_current_data()}),0))},e.prototype.addAnnotation=function(e,t){this.stopwatch.addAnnotation(e,t)},e.prototype.removeAnnotation=function(e){this.stopwatch.removeAnnotation(e)},e.prototype.reportMisuse=function(e){e="ClientStopwatch: "+e,this.strictAssert?s.assert(!1,e):s.reportStack(e,{severity:s.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})},e})()})),define("apex-metrics",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TimeUnit=n,(function(e){e[e.NANOSECONDS=0]="NANOSECONDS",e[e.MILLISECONDS=1]="MILLISECONDS",e[e.SECONDS=2]="SECONDS",e[e.MINUTES=3]="MINUTES",e[e.HOURS=4]="HOURS",e[e.DAYS=5]="DAYS"})(n||(t.TimeUnit=n={}));var i=(function(){function e(){}return e.toMilliseconds=function(e){switch(e.unit){case n.NANOSECONDS:return e.value/1e6;case n.MILLISECONDS:return e.value;case n.SECONDS:return 1e3*e.value;case n.MINUTES:return 6e4*e.value;case n.HOURS:return 36e5*e.value;case n.DAYS:return 24*e.value*36e5}},e})();t.Instant=i;var o=(function(){function e(){}return e.prototype.now=function(){return{value:performance.now(),unit:n.MILLISECONDS}},e})();t.BrowserPerformanceClock=o;var r=(function(){function e(e){this.jitterStrategy=e}return e.prototype.executeEvery=function(e,t){var n=this,o=i.toMilliseconds(e),r=i.toMilliseconds(this.jitterStrategy());setTimeout((function(){t()&&n.executeEvery(e,t)}),o+r)},e})();t.SetTimeoutExecutor=r;var a=new RegExp("^[^0-9a-zA-Z]+"),s=new RegExp("[^0-9a-zA-Z._-]","g"),c=s,p=new RegExp("[^0-9a-zA-Z/._-]","g"),u=s;function l(e){return{ns:m(e.ns),name:_(e.name)}}function d(e){var t={};for(var n in e){if(e.hasOwnProperty(n))t[f(n,"tag name",256,a,u)]=f(e[n],"tag value",256)}return t}function m(e){return f(e,"namespace",256,a,c)}function _(e){return f(e,"metric name",256,a,p)}function f(e,t,n,i,o){var r=[];if("string"!=typeof e&&r.push("identifier is not a string"),i&&i.test(e)&&r.push("invalid prefix"),o&&o.test(e)&&r.push("invalid characters"),e.length>n&&r.push("exceeds "+n+" characters"),0===e.length&&r.push("is empty"),0!==r.length)throw new Error(t+" identifier '"+e+"' is invalid: "+r);return e}t.validateMetric=l,t.validateTags=d,t.validateNamespace=m,t.validateMetricName=_;var h=(function(){function e(e,t,n){void 0===n&&(n={}),this.sink=e,this.clock=t,this.tags=n}return e.root=function(t,n){return new e(t,n)},e.prototype.child=function(t){return new e(this.sink,this.clock,Object.assign(Object.assign({},this.tags),d(t)))},e.prototype.createStats=function(e,t){return void 0===t&&(t={}),new g(l(e),Object.assign(Object.assign({},this.tags),d(t)),this.sink)},e.prototype.createCounter=function(e,t){return void 0===t&&(t={}),new v(l(e),Object.assign(Object.assign({},this.tags),d(t)),this.sink)},e.prototype.createTimer=function(e,t){return void 0===t&&(t={}),new w(l(e),Object.assign(Object.assign({},this.tags),d(t)),this.sink,this.clock)},e})();t.MetricsReporterImpl=h;var g=(function(){function e(e,t,n){this.metric=e,this.tags=t,this.sink=n}return e.prototype.record=function(e){b(e,this.metric,this.tags,this.sink)},e.prototype.recordDuration=function(e,t){b(i.toMilliseconds({value:e,unit:t}),this.metric,this.tags,this.sink)},e})(),v=(function(){function e(e,t,n,i){void 0===i&&(i=0),this.metric=e,this.tags=t,this.sink=n,this.value=i}return e.prototype.decrement=function(e){void 0===e&&(e=1),this.value-=e},e.prototype.increment=function(e){void 0===e&&(e=1),this.value+=e},e.prototype.reset=function(e){void 0===e&&(e=0),this.value=e},e.prototype.record=function(){b(this.value,this.metric,this.tags,this.sink),this.reset()},e})(),w=(function(){function e(e,t,n,o,r){void 0===r&&(r=0),this.metric=e,this.tags=t,this.sink=n,this.clock=o,this.value=r,this.value=i.toMilliseconds(this.clock.now())}return e.prototype.record=function(){b(i.toMilliseconds(this.clock.now())-this.value,this.metric,this.tags,this.sink),this.reset()},e.prototype.reset=function(){this.value=i.toMilliseconds(this.clock.now())},e})();function b(e,t,n,i){i.recordSpan({namespace:t.ns,metricName:t.name,tags:n,samples:[e]})}var S=(function(){function e(){}return e.prototype.recordSpan=function(e){},e})();t.NoOpSink=S;var y=(function(){function e(){}return e.prototype.executeEvery=function(e,t){},e})();t.NoOpExecutor=y})),define("google/protobuf/any",["require","exports","tslib","protobufjs/minimal"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r,a=(i=n.__importStar(i)).Reader,s=i.Writer,c=i.util,p=i.roots.default||(i.roots.default={});t.default=p,t.google=p.google=((o=p.google||{}).protobuf=((r=o.protobuf||{}).Any=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.typeUrl="",e.prototype.value=c.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.typeUrl&&Object.hasOwnProperty.call(e,"typeUrl")&&t.uint32(10).string(e.typeUrl),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).bytes(e.value),t},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.google.protobuf.Any;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.typeUrl=e.string();break;case 2:i.value=e.bytes();break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Any"},e})(r.Any||{}),r),o)})),define("google/protobuf/empty",["require","exports","tslib","protobufjs/minimal"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r,a=(i=n.__importStar(i)).Reader,s=i.Writer,c=(i.util,i.roots.default||(i.roots.default={}));t.default=c,t.google=c.google=((o=c.google||{}).protobuf=((r=o.protobuf||{}).Empty=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),t},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.google.protobuf.Empty;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return i},e.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Empty"},e})(r.Empty||{}),r),o)})),define("google/protobuf/timestamp",["require","exports","tslib","protobufjs/minimal"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r,a=(i=n.__importStar(i)).Reader,s=i.Writer,c=i.util,p=i.roots.default||(i.roots.default={});t.default=p,t.google=p.google=((o=p.google||{}).protobuf=((r=o.protobuf||{}).Timestamp=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seconds=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.nanos=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.seconds&&Object.hasOwnProperty.call(e,"seconds")&&t.uint32(8).int64(e.seconds),null!=e.nanos&&Object.hasOwnProperty.call(e,"nanos")&&t.uint32(16).int32(e.nanos),t},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new p.google.protobuf.Timestamp;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.seconds=e.int64();break;case 2:i.nanos=e.int32();break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/google.protobuf.Timestamp"},e})(r.Timestamp||{}),r),o)})),define("proto_utils/unpack",["require","exports","google/protobuf/any"],(function(e,t,n){"use strict";function i(e){return e.constructor.encode(e).finish()}Object.defineProperty(t,"__esModule",{value:!0}),t.wrapInProtoAny=function(e,t){var o={value:i(e)};return null!=t&&(o.typeUrl=t),n.google.protobuf.Any.create(o)},t.packProto=function(e){for(var t=i(e),n="",o=0;o<t.byteLength;o++)n+=String.fromCharCode(t[o]);return btoa(n)},t.unpackProto=function(e,t){for(var i=atob(e),o=i.length,r=new Uint8Array(o),a=0;a<o;a++)r[a]=i.charCodeAt(a);var s,c=function(e){try{return t.decode(e)}catch(e){throw new Error("Invalid data while trying to unpack encoded proto: "+e)}};try{s=n.google.protobuf.Any.decode(r)}catch(e){}return s&&s.typeUrl&&s.typeUrl.startsWith("type.googleapis.com/")&&s.value?c(s.value):c(r)}})),define("dropbox/proto/js_init_data/web_timing_logger/web_timing_logger",["require","exports","tslib","protobufjs/minimal"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=(i=n.__importStar(i)).Reader,a=i.Writer,s=i.util,c=i.roots.default||(i.roots.default={});t.default=c,t.web_timing_logger=c.web_timing_logger=((o=c.web_timing_logger||{}).WebTimingLoggerServerContext=(function(e){function e(e){if(this.subtypes={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.isDws=!1,e.prototype.dwsOpts=null,e.prototype.sourceType=0,e.prototype.subtypes=s.emptyObject,e.prototype.url="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.isDws&&Object.hasOwnProperty.call(e,"isDws")&&t.uint32(8).bool(e.isDws),null!=e.dwsOpts&&Object.hasOwnProperty.call(e,"dwsOpts")&&c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.encode(e.dwsOpts,t.uint32(18).fork()).ldelim(),null!=e.sourceType&&Object.hasOwnProperty.call(e,"sourceType")&&t.uint32(24).int32(e.sourceType),null!=e.subtypes&&Object.hasOwnProperty.call(e,"subtypes"))for(var n=Object.keys(e.subtypes),i=0;i<n.length;++i)t.uint32(34).fork().uint32(10).string(n[i]).uint32(18).string(e.subtypes[n[i]]).ldelim();return null!=e.url&&Object.hasOwnProperty.call(e,"url")&&t.uint32(42).string(e.url),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n,i,o=void 0===t?e.len:e.pos+t,a=new c.web_timing_logger.WebTimingLoggerServerContext;e.pos<o;){var p=e.uint32();switch(p>>>3){case 1:a.isDws=e.bool();break;case 2:a.dwsOpts=c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.decode(e,e.uint32());break;case 3:a.sourceType=e.int32();break;case 4:a.subtypes===s.emptyObject&&(a.subtypes={});var u=e.uint32()+e.pos;for(n="",i="";e.pos<u;){var l=e.uint32();switch(l>>>3){case 1:n=e.string();break;case 2:i=e.string();break;default:e.skipType(7&l)}}a.subtypes[n]=i;break;case 5:a.url=e.string();break;default:e.skipType(7&p)}}return a},e.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext"},e.DWSOptions=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.isDws2=!1,e.prototype.isEarlyEnsemble=!1,e.prototype.jsPreloading=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.isDws2&&Object.hasOwnProperty.call(e,"isDws2")&&t.uint32(8).bool(e.isDws2),null!=e.isEarlyEnsemble&&Object.hasOwnProperty.call(e,"isEarlyEnsemble")&&t.uint32(16).bool(e.isEarlyEnsemble),null!=e.jsPreloading&&Object.hasOwnProperty.call(e,"jsPreloading")&&t.uint32(24).bool(e.jsPreloading),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.web_timing_logger.WebTimingLoggerServerContext.DWSOptions;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.isDws2=e.bool();break;case 2:i.isEarlyEnsemble=e.bool();break;case 3:i.jsPreloading=e.bool();break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext.DWSOptions"},e})(e.DWSOptions||{}),e.SourceType=(t={},(n=Object.create(t))[t[0]="UNKNOWN"]=0,n[t[1]="DESKTOP_WEB"]=1,n[t[2]="MOBILE_WEB"]=2,n),e})(o.WebTimingLoggerServerContext||{}),o)})),define("dropbox/proto/apex_metrics_web/apex_metrics_web",["require","exports","tslib","protobufjs/minimal","google/protobuf/empty","google/protobuf/timestamp"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=(i=n.__importStar(i)).Reader,a=i.Writer,s=i.util,c=i.roots.default||(i.roots.default={});t.default=c,t.apex_metrics_web=c.apex_metrics_web=((o=c.apex_metrics_web||{}).RecordNamespace=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace"},e.MetricReportingConfigV2=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.metricNamespace="",e.prototype.maxTimeUntilRefreshSeconds=0,e.prototype.stopPublicationForSeconds=0,e.prototype.dropSamples=null,e.prototype.dropPeriods=null,e.prototype.dropFractionOfHostsPerMetric=0,e.prototype.aggregationIntervalSeconds=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.metricNamespace&&Object.hasOwnProperty.call(e,"metricNamespace")&&t.uint32(10).string(e.metricNamespace),null!=e.maxTimeUntilRefreshSeconds&&Object.hasOwnProperty.call(e,"maxTimeUntilRefreshSeconds")&&t.uint32(16).uint32(e.maxTimeUntilRefreshSeconds),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(24).uint32(e.stopPublicationForSeconds),null!=e.dropSamples&&Object.hasOwnProperty.call(e,"dropSamples")&&c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropSamples,t.uint32(34).fork()).ldelim(),null!=e.dropPeriods&&Object.hasOwnProperty.call(e,"dropPeriods")&&c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropPeriods,t.uint32(42).fork()).ldelim(),null!=e.dropFractionOfHostsPerMetric&&Object.hasOwnProperty.call(e,"dropFractionOfHostsPerMetric")&&t.uint32(49).double(e.dropFractionOfHostsPerMetric),null!=e.aggregationIntervalSeconds&&Object.hasOwnProperty.call(e,"aggregationIntervalSeconds")&&t.uint32(56).uint32(e.aggregationIntervalSeconds),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.MetricReportingConfigV2;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.metricNamespace=e.string();break;case 2:i.maxTimeUntilRefreshSeconds=e.uint32();break;case 3:i.stopPublicationForSeconds=e.uint32();break;case 4:i.dropSamples=c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 5:i.dropPeriods=c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 6:i.dropFractionOfHostsPerMetric=e.double();break;case 7:i.aggregationIntervalSeconds=e.uint32();break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.MetricReportingConfigV2"},e})(e.MetricReportingConfigV2||{}),e.StickyBiasedCoinV2=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.fraction=0,e.prototype.stickiness=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.fraction&&Object.hasOwnProperty.call(e,"fraction")&&t.uint32(9).double(e.fraction),null!=e.stickiness&&Object.hasOwnProperty.call(e,"stickiness")&&c.apex_metrics_web.RecordNamespace.StickinessV2.encode(e.stickiness,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.fraction=e.double();break;case 2:i.stickiness=c.apex_metrics_web.RecordNamespace.StickinessV2.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickyBiasedCoinV2"},e})(e.StickyBiasedCoinV2||{}),e.StickinessV2=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.independent=null,e.prototype.permanent=null,e.prototype.nResults=0,e.prototype.nSeconds=0,Object.defineProperty(e.prototype,"limit",{get:s.oneOfGetter(t=["independent","permanent","nResults","nSeconds"]),set:s.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.independent&&Object.hasOwnProperty.call(e,"independent")&&c.google.protobuf.Empty.encode(e.independent,t.uint32(10).fork()).ldelim(),null!=e.permanent&&Object.hasOwnProperty.call(e,"permanent")&&c.google.protobuf.Empty.encode(e.permanent,t.uint32(18).fork()).ldelim(),null!=e.nResults&&Object.hasOwnProperty.call(e,"nResults")&&t.uint32(24).uint32(e.nResults),null!=e.nSeconds&&Object.hasOwnProperty.call(e,"nSeconds")&&t.uint32(37).float(e.nSeconds),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.StickinessV2;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.independent=c.google.protobuf.Empty.decode(e,e.uint32());break;case 2:i.permanent=c.google.protobuf.Empty.decode(e,e.uint32());break;case 3:i.nResults=e.uint32();break;case 4:i.nSeconds=e.float();break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickinessV2"},e})(e.StickinessV2||{}),e.RecordResponse=(function(e){function e(e){if(this.reportingConfigs=[],this.debugInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.reportingConfigs=s.emptyArray,e.prototype.publicationIntervalSeconds=0,e.prototype.maxScopesPerRequest=0,e.prototype.stopPublicationForSeconds=0,e.prototype.debugInfos=s.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.reportingConfigs&&e.reportingConfigs.length)for(var n=0;n<e.reportingConfigs.length;++n)c.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.encode(e.reportingConfigs[n],t.uint32(10).fork()).ldelim();if(null!=e.publicationIntervalSeconds&&Object.hasOwnProperty.call(e,"publicationIntervalSeconds")&&t.uint32(24).uint32(e.publicationIntervalSeconds),null!=e.maxScopesPerRequest&&Object.hasOwnProperty.call(e,"maxScopesPerRequest")&&t.uint32(32).uint32(e.maxScopesPerRequest),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(40).uint32(e.stopPublicationForSeconds),null!=e.debugInfos&&e.debugInfos.length)for(n=0;n<e.debugInfos.length;++n)t.uint32(50).string(e.debugInfos[n]);return t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.RecordNamespace.RecordResponse;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.reportingConfigs&&i.reportingConfigs.length||(i.reportingConfigs=[]),i.reportingConfigs.push(c.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.decode(e,e.uint32()));break;case 3:i.publicationIntervalSeconds=e.uint32();break;case 4:i.maxScopesPerRequest=e.uint32();break;case 5:i.stopPublicationForSeconds=e.uint32();break;case 6:i.debugInfos&&i.debugInfos.length||(i.debugInfos=[]),i.debugInfos.push(e.string());break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.RecordResponse"},e})(e.RecordResponse||{}),e})(o.RecordNamespace||{}),o.ApexMetricsCacheData=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.config=null,e.prototype.timeStored=null,e.prototype.state=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.config&&Object.hasOwnProperty.call(e,"config")&&c.apex_metrics_web.RecordNamespace.RecordResponse.encode(e.config,t.uint32(10).fork()).ldelim(),null!=e.timeStored&&Object.hasOwnProperty.call(e,"timeStored")&&c.google.protobuf.Timestamp.encode(e.timeStored,t.uint32(18).fork()).ldelim(),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&c.apex_metrics_web.ApexMetricsCacheData.FilterState.encode(e.state,t.uint32(26).fork()).ldelim(),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.ApexMetricsCacheData;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.config=c.apex_metrics_web.RecordNamespace.RecordResponse.decode(e,e.uint32());break;case 2:i.timeStored=c.google.protobuf.Timestamp.decode(e,e.uint32());break;case 3:i.state=c.apex_metrics_web.ApexMetricsCacheData.FilterState.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData"},e.CoinState=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lastFlipTime=null,e.prototype.lastResult=!1,e.prototype.numTimesChecked=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.lastFlipTime&&Object.hasOwnProperty.call(e,"lastFlipTime")&&c.google.protobuf.Timestamp.encode(e.lastFlipTime,t.uint32(10).fork()).ldelim(),null!=e.lastResult&&Object.hasOwnProperty.call(e,"lastResult")&&t.uint32(16).bool(e.lastResult),null!=e.numTimesChecked&&Object.hasOwnProperty.call(e,"numTimesChecked")&&t.uint32(24).uint32(e.numTimesChecked),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.ApexMetricsCacheData.CoinState;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.lastFlipTime=c.google.protobuf.Timestamp.decode(e,e.uint32());break;case 2:i.lastResult=e.bool();break;case 3:i.numTimesChecked=e.uint32();break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.CoinState"},e})(e.CoinState||{}),e.NamespaceCoinState=(function(e){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dropPeriodCoin=null,e.prototype.dropSamplesCoin=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.dropPeriodCoin&&Object.hasOwnProperty.call(e,"dropPeriodCoin")&&c.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropPeriodCoin,t.uint32(10).fork()).ldelim(),null!=e.dropSamplesCoin&&Object.hasOwnProperty.call(e,"dropSamplesCoin")&&c.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropSamplesCoin,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new c.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.dropPeriodCoin=c.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;case 2:i.dropSamplesCoin=c.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState"},e})(e.NamespaceCoinState||{}),e.FilterState=(function(e){function e(e){if(this.namespaceCoinState={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.filterID=0,e.prototype.namespaceCoinState=s.emptyObject,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.filterID&&Object.hasOwnProperty.call(e,"filterID")&&t.uint32(8).uint32(e.filterID),null!=e.namespaceCoinState&&Object.hasOwnProperty.call(e,"namespaceCoinState"))for(var n=Object.keys(e.namespaceCoinState),i=0;i<n.length;++i)t.uint32(18).fork().uint32(10).string(n[i]),c.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.encode(e.namespaceCoinState[n[i]],t.uint32(18).fork()).ldelim().ldelim();return t},e.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n,i,o=void 0===t?e.len:e.pos+t,a=new c.apex_metrics_web.ApexMetricsCacheData.FilterState;e.pos<o;){var p=e.uint32();switch(p>>>3){case 1:a.filterID=e.uint32();break;case 2:a.namespaceCoinState===s.emptyObject&&(a.namespaceCoinState={});var u=e.uint32()+e.pos;for(n="",i=null;e.pos<u;){var l=e.uint32();switch(l>>>3){case 1:n=e.string();break;case 2:i=c.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.decode(e,e.uint32());break;default:e.skipType(7&l)}}a.namespaceCoinState[n]=i;break;default:e.skipType(7&p)}}return a},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.FilterState"},e})(e.FilterState||{}),e})(o.ApexMetricsCacheData||{}),o)}));
//# sourceMappingURL=pkg-timing.min.js-vflL_b5h6.map